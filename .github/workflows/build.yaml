name: Build
on:
    push:
        branches:
            - 'main'
        paths:
            - Dockerfile
jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - run: echo "🐋 Dockerfile change detected by a ${{ github.event_name }} event!"
            - run: echo "🧪 This job, running on ${{ runner.os }}, will test to see if the dockerfile can successfully build an image"
            - run: echo "🌳 This is running on the ${{ github.ref }} branch of ${{ github.repository }}"
            
            - name: Check Out
              uses: actions/checkout@v4
            - run: echo "🏃‍➡️ ${{ github.repository }} has been cloned to ${{ runner.name }}"
            
            - run: echo "🏗️ Setting up Docker Buildx..."
            - name: Setup Docker Buildx
              uses: docker/setup-buildx-action@v3

            - name: Get Date and Time
              id: datetime
              run: echo "DATETIME=$(date +'%Y%m%d%H%M%S')" >> $GITHUB_ENV

            - name: Set Image Tag
              run: echo "IMAGE_TAG=openvdb${{ env.DATETIME }}" >> $GITHUB_ENV

            - run: echo "🚜 Building docker image ${{ env.IMAGE_TAG }}"
            - name: Build Docker Image 
              run: docker build -t "${{ env.IMAGE_TAG }}" .

            - run: echo "🏁 all steps complete"