name: Build
on:
    push:
        branches:
            - 'main'
        paths:
            - Dockerfile
jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - run: echo "🐋 Dockerfile change detected by a ${{github.event_name}} event!"
            - run: echo "🧪 This job, running on ${{runner.os}}, will test to see if the dockerfile can succesfully build an image"
            - run: echo "🌳 This is running on the ${{github.ref}} branch of ${{github.repository}}"
            
            - name: Check Out
              uses: actions/checkout@v4
            - run: echo "🏃‍➡️ ${{github.repository}} has been cloned to ${{runner.name}}"
            
            - run: echo "🏗️ Setting up Docker Buildx..."
            - name: Setup Docker Buildx
              uses: docker/setup-buildx-action@v3
            
            - name: Sanitize PR Title to Create Docker Image Tag
              id: sanitize
              run: echo "title=$(echo ${{ github.event.head_commit.message }} | tr -cs '[:alnum:]' '-')" >> $GITHUB_OUTPUT

            - name: Create Set Docker Tag
              run: echo "SANITIZED_TITLE=${{ steps.sanitize.outputs.title }}" >> $GITHUB_ENV 

            - run: echo "🚜 Building docker image ${{env.SANITIZED_TITLE}}"
            - name: Build Docker Image 
              run: docker build -t "${{env.SANITIZED_TITLE}}" .

            - run: echo "🏁 all steps complete"